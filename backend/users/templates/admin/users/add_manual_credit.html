{% extends "admin/base_site.html" %}
{% load static %}

{% block extrastyle %}
<style>
    #content {
        max-width: 800px;
        margin: 30px auto;
        background: #1a1a1a;
        padding: 30px;
        border-radius: 8px;
    }
    
    #content h1 {
        color: #ffffff;
    }
    
    .selected-users-box {
        background: #3c5d6b;
        border: 1px solid #4a7080;
        border-radius: 4px;
        padding: 20px;
        margin-bottom: 25px;
    }
    
    .selected-users-box h3 {
        margin: 0 0 15px 0;
        color: #ffffff;
        font-size: 15px;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .users-list {
        margin: 0;
        padding: 0;
        list-style: none;
    }
    
    .users-list li {
        padding: 12px 15px;
        margin-bottom: 8px;
        background: #2a2a2a;
        border: 1px solid #4a7080;
        border-radius: 4px;
        color: #e0e0e0;
        font-size: 13px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .user-email {
        font-weight: 500;
        color: #88c0d0;
    }
    
    .user-balance {
        color: #a3be8c;
        font-size: 12px;
        background: #2e3440;
        padding: 4px 10px;
        border-radius: 3px;
        font-weight: 500;
    }
    
    .form-row {
        margin-bottom: 20px;
        background: #3c5d6b;
        padding: 15px;
        border-radius: 6px;
    }
    
    .form-row label {
        display: block;
        margin-bottom: 6px;
        font-weight: 600;
        color: #ffffff;
        font-size: 13px;
    }
    
    .form-row .required {
        color: #c00;
    }
    
    .form-row input[type="number"],
    .form-row input[type="text"],
    .form-row textarea {
        width: 100%;
        padding: 8px 10px;
        border: 1px solid #ccc;
        border-radius: 4px;
        font-size: 13px;
        box-sizing: border-box;
        background: white;
        color: #333;
    }
    
    .form-row input:focus,
    .form-row textarea:focus {
        outline: none;
        border-color: #417690;
        box-shadow: 0 0 0 2px rgba(65, 118, 144, 0.1);
    }
    
    .form-row textarea {
        resize: vertical;
        min-height: 70px;
        font-family: inherit;
    }
    
    .help-text {
        display: block;
        margin-top: 5px;
        color: #d0d0d0;
        font-size: 12px;
    }
    
    .submit-row {
        margin-top: 25px;
        padding-top: 15px;
        border-top: 1px solid #4a7080;
        display: flex;
        gap: 10px;
    }
    
    .submit-row input[type="submit"],
    .submit-row .button {
        padding: 10px 20px;
        font-size: 13px;
        border-radius: 4px;
        cursor: pointer;
        border: none;
        text-decoration: none;
        display: inline-block;
        min-width: 140px;
        text-align: center;
    }
    
    .submit-row input[type="submit"] {
        background: #417690;
        color: white;
    }
    
    .submit-row input[type="submit"]:hover {
        background: #346880;
    }
    
    .submit-row .button {
        background: #5a5a5a;
        color: white;
    }
    
    .submit-row .button:hover {
        background: #4a4a4a;
    }
    
    .messagelist {
        margin: 0 0 20px 0;
        padding: 0;
        list-style: none;
    }
    
    .messagelist li {
        padding: 12px 15px;
        border-radius: 4px;
        margin-bottom: 10px;
        font-size: 13px;
    }
    
    .messagelist .success {
        background: #d4edda;
        border: 1px solid #c3e6cb;
        color: #155724;
    }
    
    .messagelist .error {
        background: #f8d7da;
        border: 1px solid #f5c6cb;
        color: #721c24;
    }
</style>
{% endblock %}

{% block content %}

{% if messages %}
<ul class="messagelist">
    {% for message in messages %}
    <li class="{{ message.tags }}">{{ message }}</li>
    {% endfor %}
</ul>
{% endif %}

<div class="selected-users-box">
    <h3>
        <svg width="18" height="18" fill="currentColor" viewBox="0 0 16 16">
            <path d="M15 14s1 0 1-1-1-4-5-4-5 3-5 4 1 1 1 1h8zm-7.978-1A.261.261 0 0 1 7 12.996c.001-.264.167-1.03.76-1.72C8.312 10.629 9.282 10 11 10c1.717 0 2.687.63 3.24 1.276.593.69.758 1.457.76 1.72l-.008.002a.274.274 0 0 1-.014.002H7.022zM11 7a2 2 0 1 0 0-4 2 2 0 0 0 0 4zm3-2a3 3 0 1 1-6 0 3 3 0 0 1 6 0zM6.936 9.28a5.88 5.88 0 0 0-1.23-.247A7.35 7.35 0 0 0 5 9c-4 0-5 3-5 4 0 .667.333 1 1 1h4.216A2.238 2.238 0 0 1 5 13c0-1.01.377-2.042 1.09-2.904.243-.294.526-.569.846-.816zM4.92 10A5.493 5.493 0 0 0 4 13H1c0-.26.164-1.03.76-1.724.545-.636 1.492-1.256 3.16-1.275zM1.5 5.5a3 3 0 1 1 6 0 3 3 0 0 1-6 0zm3-2a2 2 0 1 0 0 4 2 2 0 0 0 0-4z"/>
        </svg>
        Usuários Selecionados
    </h3>
    <ul class="users-list">
    {% for user in selected_users %}
        <li>
            <span>
                <span class="user-email">{{ user.email }}</span>
                {% if user.name %}<span style="color: #666;"> - {{ user.name }}</span>{% endif %}
            </span>
            <span class="user-balance">Saldo: R$ {{ user.user_balance.remaining }}</span>
        </li>
    {% endfor %}
    </ul>
</div>

<form method="post">
    {% csrf_token %}
    <input type="hidden" name="user_ids" value="{{ user_ids }}">
    
    <div class="form-row">
        <label for="amount">
            Valor (R$)
            <span class="required">*</span>
        </label>
        <input 
            type="number" 
            name="amount" 
            id="amount" 
            step="0.01" 
            min="0.01" 
            required 
            placeholder="0.00"
        >
    </div>
    
    <div class="form-row">
        <label for="description">
            Descrição
            <span class="required">*</span>
        </label>
        <input 
            type="text" 
            name="description" 
            id="description" 
            required 
            maxlength="255"
            placeholder="Ex: Crédito de cortesia, Compensação, etc."
        >
        <span class="help-text">Esta descrição será visível para o usuário</span>
    </div>
    
    <div class="form-row">
        <label for="admin_notes">
            Observações Internas
        </label>
        <textarea 
            name="admin_notes" 
            id="admin_notes" 
            placeholder="Anotações visíveis apenas para administradores"
        ></textarea>
        <span class="help-text">Opcional - informações para controle interno</span>
    </div>
    
    <div class="submit-row">
        <input type="submit" value="Adicionar Crédito" class="default">
        <a href="{% url 'admin:users_balance_changelist' %}" class="button cancel-link">Cancelar</a>
    </div>
</form>

<script>
// Formata o input de valor para sempre ter 2 casas decimais
document.getElementById('amount').addEventListener('blur', function(e) {
    if (e.target.value) {
        e.target.value = parseFloat(e.target.value).toFixed(2);
    }
});
</script>
{% endblock %}
